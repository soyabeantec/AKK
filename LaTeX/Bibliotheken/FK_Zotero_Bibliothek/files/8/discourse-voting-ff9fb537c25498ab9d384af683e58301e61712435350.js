define("discourse/plugins/discourse-voting/discourse/feature-voting-route-map",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={resource:"user",path:"users/:username",map:function(){this.route("userActivity",{path:"activity",resetNamespace:!0},function(){this.route("votes")})}}}),define("discourse/plugins/discourse-voting/discourse/routes/user-activity-votes",["exports","discourse/routes/user-topic-list","discourse/models/user-action"],function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e.default.extend({userActionType:o.default.TYPES.topics,model:function(){return this.store.findFiltered("topicList",{filter:"topics/voted-by/"+this.modelFor("user").get("username_lower")})}})}),define("discourse/plugins/discourse-voting/discourse/widgets/vote-box",["exports","discourse/widgets/widget","discourse/lib/ajax","discourse/widgets/raw-html","discourse/lib/ajax-error"],function(t,e,o,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("vote-box",{tagName:"div.voting-wrapper",buildKey:function(){return"vote-box"},buildClasses:function(){if(this.siteSettings.voting_show_who_voted)return"show-pointer"},defaultState:function(){return{allowClick:!0,initialVote:!1}},html:function(t,e){var o=this.attach("vote-count",t),s=this.attach("vote-button",t),n=this.attach("vote-options",t),r=[o,s,n];if(e.votesAlert>0){var u="<div class='voting-popup-menu vote-options popup-menu'>"+I18n.t("voting.votes_left",{count:e.votesAlert,path:this.currentUser.get("path")+"/activity/votes"})+"</div>";r.push(new i.default({html:u}))}return r},hideVotesAlert:function(){this.state.votesAlert&&(this.state.votesAlert=null,this.scheduleRerender())},click:function(){this.hideVotesAlert()},clickOutside:function(){this.hideVotesAlert()},addVote:function(){var t=this,e=this.attrs,i=this.state;return(0,o.ajax)("/voting/vote",{type:"POST",data:{topic_id:e.id}}).then(function(o){e.set("vote_count",o.vote_count),e.set("user_voted",!0),t.currentUser.set("votes_exceeded",!o.can_vote),o.alert&&(i.votesAlert=o.votes_left),e.set("who_voted",o.who_voted),i.allowClick=!0,t.scheduleRerender()}).catch(s.popupAjaxError)},removeVote:function(){var t=this,e=this.attrs,i=this.state;return(0,o.ajax)("/voting/unvote",{type:"POST",data:{topic_id:e.id}}).then(function(o){e.set("vote_count",o.vote_count),e.set("user_voted",!1),t.currentUser.set("votes_exceeded",!o.can_vote),e.set("who_voted",o.who_voted),i.allowClick=!0,t.scheduleRerender()}).catch(s.popupAjaxError)}})}),define("discourse/plugins/discourse-voting/discourse/widgets/vote-button",["exports","discourse/widgets/widget"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("vote-button",{tagName:"button.btn.btn-primary.vote-button",buildClasses:function(t){var e="";return e=t.closed?"voting-closed":t.user_voted?this.currentUser&&this.currentUser.votes_exceeded?"vote-limited nonvote":"vote":"nonvote",this.siteSettings.voting_show_who_voted&&(e+=" show-pointer"),e},html:function(t){I18n.t("voting.vote_title");return this.currentUser?t.closed?I18n.t("voting.voting_closed_title"):t.user_voted?I18n.t("voting.voted_title"):this.currentUser&&this.currentUser.votes_exceeded?I18n.t("voting.voting_limit"):I18n.t("voting.vote_title"):t.vote_count?I18n.t("voting.anonymous_button",{count:t.vote_count}):I18n.t("voting.anonymous_button",{count:1})},click:function(){if(!this.currentUser)return this.sendWidgetAction("showLogin"),void $.cookie("destination_url",window.location.href);this.attrs.closed||!this.parentWidget.state.allowClick||this.attrs.user_voted||(this.parentWidget.state.allowClick=!1,this.parentWidget.state.initialVote=!0,this.sendWidgetAction("addVote")),(this.attrs.user_voted||this.currentUser.votes_exceeded)&&$(".vote-options").toggle()},clickOutside:function(){$(".vote-options").hide(),this.parentWidget.state.initialVote=!1}})}),define("discourse/plugins/discourse-voting/discourse/widgets/vote-options",["exports","discourse/widgets/widget","virtual-dom"],function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("vote-options",{tagName:"div.vote-options",buildClasses:function(){return"voting-popup-menu popup-menu hidden"},html:function(t){var e=[];return t.user_voted?e.push(this.attach("remove-vote",t)):this.currentUser&&this.currentUser.votes_exceeded&&!t.user_voted&&e.push([(0,o.h)("div",I18n.t("voting.reached_limit")),(0,o.h)("p",(0,o.h)("a",{href:this.currentUser.get("path")+"/activity/votes"},I18n.t("voting.list_votes")))]),e}})}),define("discourse/plugins/discourse-voting/discourse/widgets/remove-vote",["exports","discourse/widgets/widget","discourse-common/lib/icon-library"],function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("remove-vote",{tagName:"div.remove-vote",buildClasses:function(){return"vote-option"},html:function(){return[(0,o.iconNode)("times"),I18n.t("voting.remove_vote")]},click:function(){this.sendWidgetAction("removeVote")}})}),define("discourse/plugins/discourse-voting/discourse/widgets/vote-count",["exports","discourse/widgets/widget","virtual-dom","discourse/lib/ajax"],function(t,e,o,i){"use strict";function s(t){return{template:t.avatar_template,username:t.username,post_url:t.post_url,url:Discourse.getURL("/users/")+t.username.toLowerCase()}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("vote-count",{tagName:"div.vote-count-wrapper",buildKey:function(){return"vote-count"},buildClasses:function(){if(0===this.attrs.vote_count)return"no-votes"},defaultState:function(){return{whoVotedUsers:null}},html:function(t){var e=(0,o.h)("div.vote-count",t.vote_count.toString()),i=null;this.siteSettings.voting_show_who_voted&&this.state.whoVotedUsers&&this.state.whoVotedUsers.length>0&&(i=this.attach("small-user-list",{users:this.state.whoVotedUsers,addSelf:t.liked,listClassName:"regular-votes"}));var s=[e];return i&&s.push((0,o.h)("div.who-voted.popup-menu.voting-popup-menu",[i])),s},click:function(){if(this.siteSettings.voting_show_who_voted&&this.attrs.vote_count>0){if(null===this.state.whoVotedUsers)return this.getWhoVoted();$(".who-voted").toggle()}},clickOutside:function(){$(".who-voted").hide()},getWhoVoted:function(){var t=this;return(0,i.ajax)("/voting/who",{type:"GET",data:{topic_id:this.attrs.id}}).then(function(e){t.state.whoVotedUsers=e.map(s)})}})}),define("discourse/plugins/discourse-voting/discourse/pre-initializers/extend-category-for-voting",["exports","ember-addons/ember-computed-decorators","discourse/models/category","discourse/lib/plugin-api"],function(t,e,o,i){"use strict";function s(t,e,o,i,s){var n={};return Object.keys(i).forEach(function(t){n[t]=i[t]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=o.slice().reverse().reduce(function(o,i){return i(t,e,o)||o},n),s&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(t,e,n),n=null),n}function n(t){t.addPostClassesCallback(function(t){if(1===t.post_number&&t.can_vote)return["voting-post"]}),t.includePostAttributes("can_vote"),t.addTagsHtmlCallback(function(t){if(t.can_vote){var e=[],o="";t.user_voted&&(o=" title='"+I18n.t("voting.voted")+"'");var i=t.user_voted?" voted":"";return e.push("<span class='list-vote-count discourse-tag"+i+"'"+o+">"),e.push(I18n.t("voting.votes",{count:t.vote_count})),e.push("</span>"),e.length>0?e.join(""):void 0}},{priority:-100})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"extend-category-for-voting",before:"inject-discourse-objects",initialize:function(t){var r,u,a;(0,i.withPluginApi)("0.8.4",function(t){n(t)}),(0,i.withPluginApi)("0.8.30",function(t){t.addCategorySortCriteria("votes")}),o.default.reopen((r=(0,e.default)("custom_fields.enable_topic_voting"),u={enable_topic_voting:{get:function(t){return t},set:function(t){return this.set("custom_fields.enable_topic_voting",t),t}}},s(u,"enable_topic_voting",[r],(a=Object.getOwnPropertyDescriptor(u,"enable_topic_voting"),a=a?a.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return a}}),u),u))}}}),Ember.TEMPLATES["javascripts/connectors/topic-above-post-stream/topic-title-voting"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["model","can_vote"]]],null,{"statements":[[4,"if",[[25,["model","postStream","loaded"]]],null,{"statements":[[4,"if",[[25,["model","postStream","firstPostPresent"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","voting title-voting"],[9],[0,"\\n        "],[1,[29,"mount-widget",null,[["widget","args","showLogin"],["vote-box",[25,["model"]],[29,"route-action",["showLogin"],null]]]],false],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/topic-above-post-stream/topic-title-voting"}}),Ember.TEMPLATES["javascripts/connectors/user-activity-bottom/user-voted-topics"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["siteSettings","voting_show_votes_on_profile"]]],null,{"statements":[[7,"li"],[9],[0,"\\n"],[4,"link-to",null,[["route"],["userActivity.votes"]],{"statements":[[0,"    "],[1,[29,"d-icon",["heart"],null],false],[0," "],[1,[29,"i18n",["voting.vote_title_plural"],null],false],[0,"\\n"]],"parameters":[]},null],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/user-activity-bottom/user-voted-topics"}}),Ember.TEMPLATES["javascripts/connectors/extra-nav-item/votes"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["siteSettings","voting_enabled"]]],null,{"statements":[[7,"a"],[12,"title",[30,[[29,"I18n",["voting.votes_nav_help"],null]]]],[12,"href",[30,[[23,"url"]]]],[9],[1,[29,"I18n",["voting.vote_title_plural"],null],false],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/extra-nav-item/votes"}}),define("discourse/plugins/discourse-voting/discourse/templates/connectors/extra-nav-item/votes",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={setupComponent:function(t,e){e.set("url",Discourse.BaseUri+"/"+t.filterMode+"?order=votes")},shouldRender:function(t,e){var o=e.get("category");return!(!o||!o.get("can_vote"))}}}),Ember.TEMPLATES["javascripts/connectors/category-custom-settings/feature-voting-settings"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"h3"],[9],[1,[29,"i18n",["voting.title"],null],false],[10],[0,"\\n"],[7,"section"],[11,"class","field"],[9],[0,"\\n  "],[7,"div"],[11,"class","enable-topic-voting"],[9],[0,"\\n    "],[7,"label"],[11,"class","checkbox-label"],[9],[0,"\\n      "],[1,[29,"input",null,[["type","checked"],["checkbox",[25,["category","enable_topic_voting"]]]]],false],[0,"\\n      "],[1,[29,"i18n",["voting.allow_topic_voting"],null],false],[0,"\\n    "],[10],[0,"\\n  "],[10],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/category-custom-settings/feature-voting-settings"}});
//# sourceMappingURL=https://sjc5.discourse-cdn.com/elastic/assets/plugins/discourse-voting-ff9fb537c25498ab9d384af683e58301e617124353503f921cf8b464a3f02cb7.js.map